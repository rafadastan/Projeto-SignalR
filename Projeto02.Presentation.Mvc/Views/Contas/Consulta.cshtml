<h5>Consulta de Contas</h5>
<hr />

<div class="row">
    <div class="col-md-12">
        <table id="contas" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Nome da Conta</th>
                    <th>Valor</th>
                    <th>Tipo</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3">
                        Quantidade: <span id="quantidade">0</span>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

@**Conteúdo para a seção 'scripts'*@
@section scripts {

    <script src="~/js/jquery-3.6.0.min.js"></script>
    <script src="//cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="~/js/signalr.min.js"></script>

    <script>

        //conectando no HUB..
        const connection = new signalR
            .HubConnectionBuilder()
            .withUrl("/contashub")
            .build();

        //iniciando a conexão
        connection.start()
            .catch(
                e => console.log(e)
            );

        var quantidade = 0;

        //escutando as mensagens do hub
        connection.on('ReceiveMessage', (model) => {

            var conteudo = $("#contas tbody").html();

            conteudo += "<tr>";
            conteudo += "<td>" + model.nome + "</td>";
            conteudo += "<td>" + model.valor + "</td>";
            conteudo += "<td>" + (model.tipo == 1 ? "<span class='badge bg-danger'>Débito</span>" : "<span class='badge bg-success'>Crédito</span>") + "</td>";
            conteudo += "</tr>";

            $("#contas tbody").html(conteudo);

            quantidade++;
            $("#quantidade").html(quantidade);

            //formatação para datatable
            $(document).ready(function () {
                $('#contas').DataTable(
                    {
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.10.25/i18n/Portuguese-Brasil.json'
                        }
                    });
            });
        });

    </script>
}

